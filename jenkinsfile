pipeline {
    agent any


 stages{
        
        stage('MVN CLEAN') {
            steps {
               
              script {

                  sh 'mvn  clean'

 
                      }
                   }        
         }
          stage('MVN compile') {
            steps {
               
              script {

                  sh 'mvn  compile'

 
                      }
                   }        
         }
          stage('MVN test') {
            steps {
               
              script {

                  sh 'mvn  test'

 
                      }
                   }        
         }
          stage('Artifact Construction') {
                      steps{
                          sh "mvn -B -DskipTests  package "
                      }
                  }
                  
          stage('SONAR') {
            steps {
               
              script {

                  sh 'mvn  sonar:sonar  -Dsonar.sources=src/main/java -Dsonar.css.node=. -Dsonar.java.binaries=. -Dsonar.host.url=http://172.16.1.132:9000/ -Dsonar.login=admin   -Dsonar.password=sonar'

 
                      }
                   }   
                   
         }
         stage('nexus') {
            steps {
               
              script {

sh 'mvn  deploy -e'                      }
                   }         
         }
          stage('Build Docker Image'){
                      steps {
                          script{
          				    sh 'docker image build . -t yassine123456/backcicd -f backend-spring/Dockerfile '
                          }
                      }
          		}
          		stage('Docker login') {
                                steps {
                                    script {

                                        sh 'docker login -u yassine123456 -p yassine123'}
                                }
                                }
                          stage('Pushing Docker Image') {
                                steps {
                                    script {

                                     sh 'docker push yassine123456/backcicd'
                                    }
                                }
                          }
                          stage('Run Spring && MySQL Containers') {
                                steps {
                                    script {
                                      sh ' docker-compose -f backend-spring/docker-compose.yml up -d '
                                    }
                                }
                            } 
     }
     
     }
  
